<!DOCTYPE HTML>
<html>
<head>
    <style>
    .container {
        text-align: center;
        height: 100%;
        line-height: 100%;
        text-align: center;
        <!-- border: 2px dashed #f69c55; -->
        padding-bottom: 15px;
    }
    
    centered {
        display: inline-block;
        align-items: center;
        justify-content: center;
        height: 100%;
        width: 100%;
    }
    
    p {
      text-align: center;
      margin: auto;
    }
    
    label {
        position: absolute;
        right: 76%;
        height: 100%;
        margin-top: 6px;
    }
    
    select {
        width: 50%;
        padding: 5px;
        margin: auto;
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 5px;
        display: inline-block;
    }
    input {
        width: 50%;
        padding: 5px;
        margin: auto;
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 5px;
        display: inline-block;
    }
    </style>
    
    <script src="jquery-3.4.1.min.js"></script>
    <script>
    function allowDrop(ev) {
      ev.preventDefault();
    }

    function drag(ev) {
      ev.dataTransfer.setData("text", ev.target.id);
    }

    function drop(ev) {
      console.log(ev);
      window.ev = ev;
      ev.preventDefault();
      var data = ev.dataTransfer.getData("text");
      ev.target.appendChild(document.getElementById(data));
    }
    
    function onForm(form) {
        var text = '';
        var i;
        for (i = 0; i < form.length ;i++) { 
            var e = form.elements[i];
            if(e.type != "button") {
                text += (i == 0 ? "?" : "&");
                if(form.elements[i].value != "") {
                    text += e.name+"=" + form.elements[i].value;
                }
            }
        } 
        console.log(text);
        window.form = text;
        
        var frame = document.getElementById("frame");
        frame.src = "webaudio-binpanner.php"+text;
        <!-- console.log(frame); -->
        <!-- document.getElementById("copyable").innerHTML = "" + frame.outerHTML; -->
    }
    </script>
</head>
<body>
    <!-- <div class="container" style="line-height:100px;"> -->
        <!-- <div id="div1" class="centered" ondrop="drop(event)" ondragover="allowDrop(event)" style="border-style: dotted;width:200px;margin:auto;height:100px;"> -->
            <!-- <p>drop background link here</p> -->
        <!-- </div> -->
        <!-- <img id="drag1" src="img_logo.gif" draggable="true" ondragstart="drag(event)" width="336" height="69"> -->
    <!-- </div> -->
    <div class="container">
        <form id="inputdata" class="centered" ACTION="" METHOD="GET"> <!-- action="console.log('test')"> -->
            <label for="background_image">background image url</label>
            <input type="text" id="background_image" name="background_image" value="https://images.fineartamerica.com/images/artworkimages/mediumlarge/2/pastel-lake-sean-duan.jpg&opacity=0.5&colortheme=dark">
            <br>
            <label for="opacity">background image opacity</label>
            <input type="text" id="opacity" name="opacity" value="1">
            <br>
            <br>
            <label for="file">audiofiles</label>
            <input type="text" id="audiofiles" name="file" value="audio/ai/Harold%20">
            <br>
            <label for="ext">extension</label>
            <input type="text" id="extension" name="ext" value=".wav">
            <br>
            <label for="channels">numchannels</label>
            <input type="text" id="numchannels" name="channels" value="8">
            <br>
            
            <!-- <label for="colorgradient">drawing gradient</label> -->
            <!-- <input type="text" id="colorgradient" name="colorgradient" value=""> -->
            <!-- <br> -->
            
            <select name="colortheme">
                <option value="dark">dark</option>
                <option value="light">light</option>
            </select>
            <br>
            <br>
            
            <input type="hidden" id="colorgradient" name="colorgradient">
            <h3>colorgradient</h3>
            <div id="colorpicker" style="width=50%;">
            </div>
            <br>
            <br>
            
            <input type="button" value="Submit" onClick="onForm(this.form);">
        </form>
    </div>
    <div id="frameSpace" style="resize:both; overflow:auto; margin: auto; width:50%; height:400px; border: 2px solid;">
        <iframe id="frame" crossorigin="anonymous">
        </iframe>
    </div>
    <div>
        <p id="copyable"></p>
    </div>
    <script>
    document.getElementById("frameSpace").onmouseup = function() { 
        <!-- console.log("test");  -->
        var e = document.getElementById("frame");
        frame.width = document.getElementById("frameSpace").offsetWidth - 15;
        frame.height = document.getElementById("frameSpace").offsetHeight - 15;
        <!-- document.getElementById("copyable").innerHTML = e.outerHTML; -->
    }
    
    function hexToRgb(hex) {
      // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
      var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
      hex = hex.replace(shorthandRegex, function(m, r, g, b) {
        return r + r + g + g + b + b;
      });

      var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : null;
    }
    
    class ColorPicker {
        div = document.createElement("div");
        removebutton = document.createElement("button");
        addbutton = document.createElement("button");
        colorinput = document.createElement("input");
        textinput = document.createElement("input");
        divToAddTo = null;
        
        constructor(divToAddTo, startColor="#000000") {
            this.divToAddTo = divToAddTo;
            this.div.appendChild(this.removebutton);
            this.div.appendChild(this.addbutton);
            this.div.appendChild(this.colorinput);
            this.div.appendChild(this.textinput);
            divToAddTo.appendChild(this.div);
            
            this.removebutton.innerHTML = "remove";
            this.removebutton.type = "button";
            var div = this.div;
            this.removebutton.onclick = function(e) {
                if(divToAddTo.childElementCount > 1) {
                    divToAddTo.removeChild(div);
                }
            }
            
            var that = this;
            this.colorinput.type = "color";
            this.colorinput.value = startColor;
            this.colorinput.style = "width:200px;margin-left:10px;";
            this.colorinput.onchange = function() {
                that.textinput.value = that.colorinput.value;
                that.setInputElement();
            }
            
            this.textinput.type = "text";
            this.textinput.value = startColor;
            this.textinput.style = "width:100px;margin-left:10px;";
            this.textinput.onchange = function() {
                if(hexToRgb(that.textinput.value) != null) {
                    that.colorinput.value = that.textinput.value;
                    that.setInputElement();
                }
            }
            
            this.addbutton.innerHTML = "add";
            this.addbutton.type = "button";
            this.addbutton.onclick = function(e) {
                var test = new ColorPicker(divToAddTo, that.colorinput.value);
            }
            
            this.setInputElement();
        }
        
        setInputElement() {
            var input = document.getElementById("colorgradient");
            var text = "[";
            var inputs = this.divToAddTo.getElementsByTagName("input");
            
            var ins = [];
            for(var i = 0; i < inputs.length; i++) {
                if(inputs[i].type == "color") {
                    ins.push(inputs[i]);
                }
            }
            inputs = ins;
            
            for(var i = 0; i < inputs.length; i++) {
                text += "["+ (i / (inputs.length - 1)) + ",";
                <!-- console.log(inputs[i]); -->
                const c = hexToRgb(inputs[i].value);
                text += "[" + c.r + ", "+ c.g + ", " + c.b + ", 1]]";
                if(i < inputs.length - 1) {
                    text += ", ";
                }
            }
            input.value = text+"]";
            <!-- console.log(input); -->
        }
    };
    
    var colorpicker = document.getElementById("colorpicker");
    var newtest = new ColorPicker(colorpicker, "#e1eee2");
    newtest = new ColorPicker(colorpicker, "#aaffaa");
    newtest = new ColorPicker(colorpicker, "#33aa33");
    newtest = new ColorPicker(colorpicker, "#ecdb64");
    newtest = new ColorPicker(colorpicker, "#ffa020");
    newtest = new ColorPicker(colorpicker, "#ff4444");

    onForm(document.getElementById("inputdata"));
    document.getElementById("frameSpace").onmouseup();
    </script>
</body>
</html>